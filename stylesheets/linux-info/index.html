<html>
	<head>
	<title>全面了解Linux服务器 - Jaylee</title>
	<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

<link href='/images/fav.png' rel='shortcut icon'>
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/syntax.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/responsive.css' rel='stylesheet' type='text/css' />
<link href="/stylesheets/nprogress.css" rel='stylesheet' type='text/css' />
<link href="/stylesheets/duoshuo.css" rel='stylesheet' type='text/css' />

<link href="/feed.xml" rel="alternate" type="application/rss+xml">

<script src='/javascripts/jquery.js' type='text/javascript'></script>
<script src='/javascripts/jquery.particleground.min.js' type='text/javascript'></script>
<script src='/javascripts/nprogress.js' type='text/javascript'></script>
<script src='/javascripts/theater.js' type='text/javascript'></script>

<script src='/javascripts/app.js' type='text/javascript'></script>
<script>var duoshuoQuery = {short_name:"jaylee"};</script>

	</head>
	<body>

		<header>
<a id="go-back-home" href="/"><img src="/images/scribble.png" alt="Home" width="53" height="59"></a>
<p>Jaylee</p>

<div id="blog-desc">
    Do have faith in what you're doing.
</div>

</header>


		<div id='container'>
			
			<div class="block nav">
    <ul>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_top" href="/about.html">About</a>
        </li>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_top" href="/">Blog</a>
        </li>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_top" href="/feed.xml">Feed</a>
        </li>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_blank" href="https://github.com/sjclijie">GitHub</a>
        </li>
        
    </ul>

</div>


			<section class="paging">
  
    <div class="left">
      <a href="">
        ‹
      </a>
    </div>
  
  
</section>


			<div class="content">
				<section class='post'>
					<h1>
						全面了解Linux服务器
						<div class='date'>06 Apr 2016</div>
					</h1>
					<h4>查看Linux服务器的CPU的详细情况</h4>

<ul>
<li>具有相同core id的cpu是同一个core的超线程</li>
<li>具有相同physical id的cpu是同一个cpu封装的线程或核心</li>
</ul>

<h5>查看物理CPU的个数</h5>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;physical id&#39;</span> <span class="p">|</span> sort <span class="p">|</span> uniq <span class="p">|</span> wc -l
</code></pre></div>
<h5>每个CPU中core的个数(即核心数)</h5>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;cpu cores&#39;</span> <span class="p">|</span> uniq
</code></pre></div>
<h5>逻辑CPU的个数</h5>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;processor&#39;</span> <span class="p">|</span> wc -l
</code></pre></div>
<hr>

<h4>查看服务器的内存使用情况</h4>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># free -m</span>
             total       used       free     shared    buffers     cached
Mem:           994        884        110          0        151        401
-/+ buffers/cache:        330        664
Swap:          499         98        401
</code></pre></div>
<ul>
<li>total: 内存总数</li>
<li>used: 已经使用的内存数</li>
<li>free: 空闲的内存数</li>
<li>shared: 多个进程共享的内存总额, 已废弃不用,总是0</li>
<li>-buffers/cache: 已用(缓冲)内存总数, 即used-buffers-cached</li>
<li>+buffers/cache: 可用(缓冲)内存总数, 即free+buffers+cached</li>
<li>swap: 交换分区</li>
</ul>

<hr>

<h4>查看Linux服务器的硬盘使用情况</h4>

<ol>
<li>查看硬盘分区信息</li>
</ol>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># fdisk -l</span>

Disk /dev/xvda: 21.5 GB, 21474836480 bytes
255 heads, 63 sectors/track, 2610 cylinders
<span class="nv">Units</span> <span class="o">=</span> cylinders of 16065 * <span class="nv">512</span> <span class="o">=</span> 8225280 bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
Disk identifier: 0x00073f45

    Device Boot      Start         End      Blocks   Id  System
/dev/xvda1   *           1        2611    20970496   83  Linux
</code></pre></div>
<ol>
<li>检查文件系统的磁盘占用情况</li>
</ol>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># df -h</span>
文件系统          容量  已用  可用 已用%% 挂载点
/dev/xvda1             20G   11G  8.4G  56% /
tmpfs                 498M     0  498M   0% /dev/shm
</code></pre></div>
<ol>
<li>查看硬盘的I/O情况</li>
</ol>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># iostat -d -x -k 1 5</span>
Linux 2.6.32-358.6.2.el6.x86_64 <span class="o">(</span>Jaylee<span class="o">)</span>    2016年04月06日   _x86_64_    <span class="o">(</span>1 CPU<span class="o">)</span>

Device:  rrqm/s  wrqm/s  r/s   w/s  rkB/s  wkB/s avgrq-sz avgqu-sz  await  svctm  %util
xvda      0.00    0.20   1.99  0.40 45.00  2.41   39.67     0.01    5.63   0.98   0.24

Device:  rrqm/s  wrqm/s  r/s   w/s  rkB/s  wkB/s avgrq-sz avgqu-sz  await  svctm  %util
xvda      0.00    0.00   0.00  0.00  0.00  0.00   0.00     0.00     0.00   0.00   0.00

Device:  rrqm/s  wrqm/s  r/s   w/s  rkB/s  wkB/s avgrq-sz avgqu-sz  await  svctm  %util
xvda      0.00    0.00   0.00  0.00  0.00  0.00   0.00     0.00     0.00   0.00   0.00

Device:  rrqm/s  wrqm/s  r/s   w/s  rkB/s  wkB/s avgrq-sz avgqu-sz  await  svctm  %util
xvda      0.00    0.00   0.00  0.00  0.00  0.00   0.00     0.00     0.00   0.00   0.00

Device:  rrqm/s  wrqm/s  r/s   w/s  rkB/s  wkB/s avgrq-sz avgqu-sz  await  svctm  %util
xvda      0.00    0.00   0.00  0.00  0.00  0.00   0.00     0.00     0.00   0.00   0.00
</code></pre></div>
<h5>参数说明</h5>

<ul>
<li>rrqm/s: 每秒进行 merge 的读操作数目, 即 delta (rmerge) /s</li>
<li>wrqm/s: 每秒进行 merge 的写操作数目, 即 delta (wmerge) /s</li>
<li>r/s: 每秒完成的读I/O设备的次数, 即 delta (rio) /s</li>
<li>w/s: 每秒完成的写I/O设备的次数, 即 delta (wio) /s</li>
<li>rkB/s: 每秒读K字节数</li>
<li>wkB/s: 每秒写K字节数</li>
<li>avgrq-sz: 平均每次设备I/O操作的数据大小</li>
<li>avgqu-sz: 平均每次I/O队列的长度</li>
<li>await: 平均每次设备I/O操作的等待时间</li>
<li>svctm: 平均每次设备I/O操作的服务时间</li>
<li>%util: 一秒中有百分之多少的时间用于I/O操作</li>
</ul>

<blockquote>
<p>我们只需要关心以下几个方面:</p>

<ol>
<li><p>如果 %util 接近100%, 说明产生的I/O请求太多, I/O系统已经满负荷, 磁盘可能存在瓶颈</p></li>
<li><p>await 的大小取决去服务时间(svctm), 以及I/O队列的长度和I/O请求的发现模式. 这个响应时间应该低于5ms,
如果大于5ms就表示磁盘I/O压力很大, 这时就可以考虑更换SSD, 调整内核elevator的算法, 优化应用, 或者升级CPU</p></li>
</ol>
</blockquote>

<ol>
<li>查看Linux系统中某目录的大小</li>
</ol>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># du -sh vimrc</span>
292K    vimrc
</code></pre></div>
<ol>
<li>查看占用空间最多的十个文件或目录</li>
</ol>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">~ <span class="c"># du -cks * | sort -rn  | head -n 10</span>
793396  总用量
512004  swap
169072  shell
52568   nodejs
39968   mygo
6304    rdio-copy
2824    sjclijie.github.io
2444    go
2300    rails
1716    fis
</code></pre></div>
<hr>

<h4>查看Linux服务器的平均负载</h4>

				</section>
			</div>

			
				<!-- 多说评论框 start -->
<div class="block ds-thread" data-title="全面了解Linux服务器" data-url="http://www.jaylee.cc/linux-info/"></div>
<!-- 多说评论框 end -->
			

		</div>

		<script>

            jQuery(document).ready(function($) {

                App.mapKeySupport();

                App.initNProgress();

                App.initDuoshuo();

                App.initTheater();
            });

		</script>

	</body>

	<div id="particles">
    <canvas class="pg-canvas"></canvas>
</div>
<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?93757bc26a1b57b9c6a7771db256d254";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();

    $(function(){

        var $body = $("body");

        $("#particles").css({
                "width":$body.width(), 
                "height":$body.height()
            }).particleground({
                lineColor: '#e0e0e0',
                dotColor: '#EFEFEF',
                lineColor: '#EFEFEF',   
                minSpeedX :0.5,
                maxSpeedX :1,
                minSpeedY : 0.5,
                maxSpeedY :1
            });
    });
</script>
<footer>
  <span class="muted">© Jaylee. All Rights Reserved.</span><br>
  <a href="http://github.com/chloerei/scribble" class="muted">built with Jekyll using Scribble theme</a>
  <br>
  <br>
  <!--img src="/images/scribble2.png" alt="scribble" /-->
</footer>


</html>
